{% extends "index/base.html" %}

{% block title %}Перемещения{% endblock %}

{% block document-buttons %}

<a class = "AddDocument" href="{% url 'add_move_os' %}" title="Создать новый документ"><span class="create-new-document os"></span></a>

<a class = "AddDocument" href="{% url 'add_move_tmc' %}" title="Создать новый документ"><span class="create-new-document tmc"></span></a>
  
<a class="load_file" href="#" title="Загрузить данные из Excel" onclick="openFileUploadDialog()"><span class="load_file_excel"></span></a>

<div id="uploadModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closeFileUploadDialog()">&times;</span>
        {% csrf_token %}
         <div id="file-upload" data-upload-url="{% url 'upload_data' %}">
 
            <form id="uploadForm" action="{% url 'upload_data' %}" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="file" id="uploadedFile" form="uploadForm">
                <button type="submit">Загрузить</button>
            </form>
        </div> 
    </div>
</div>

<div id="table-pagination" class="step-links"></div>

<div class="table-options">

    <div class="table-length_main">

        <select id="table_os_length" name="table_os_length">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50" selected>50</option>
            <option value="100">100</option>
        </select>

    </div>

</div>

{% endblock %}


{% block content %}

<table id="table_moves" class="display" style="width:100%">
    
    <script>

    
        function openMoveDetailsModal(movePk) {
            // Пример использования jQuery для отправки AJAX-запроса
            $.ajax({
                url: `/moves/move_details/${movePk}`,  // Используем PK строки для формирования URL
                success: function(data) {
                    $("#move-details-content").html(data);
                    $("#moveDetailsModal").css("display", "block");
                }
            });
        }

        $(document).ready(function() {
            var table = $('#table_moves').DataTable();
            
            $('#table_moves tbody').on('click', 'tr', function() {
                var movePk = table.row(this).data()[1]; // Получаем значение PK из второй ячейки
                openMoveDetailsModal(movePk);
            });
        });
    </script>

    <thead>
        <tr>
            <th>Тип</th>
            <th>PK</th>
            <th>Номер перемещения</th>
            <th>Дата</th>
            <th>МОЛ</th>
            <th>Склад</th>
            <th>Комментарий</th>
            <th>Действия</th>
        </tr>
    </thead>
</table>
<div id="moveDetailsModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" onclick="closeMoveDetailsModal()">&times;</span>
        <div id="move-details-content">
            <!-- Здесь будут отображаться детали перемещения -->
        </div>
    </div>
</div>
{% endblock %}